---
layout: post
title: Setting JAVA_HOME in a Batch File
categories:
- Programming
tags:
- batch
- code
- ruby
- windows
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  pvc_views: '2'
  syntaxhighlighter_encoded: '1'
  dsq_thread_id: '605782116'
author:
  login: air0day
  email: blog@air0day.com
  display_name: Rod Hilton
  first_name: Rod
  last_name: Hilton
---
<p>Recently at work I had a bizarre problem to deal with.  Essentially, we are distributing an application that uses <a href="http://jruby.codehaus.org/">JRuby</a>, and we were encountering a problem whenever people would use our application in Windows if they installed Java in a specific way.</p>
<p>A lot of Windows users install Java not by putting the bits on disk and setting JAVA_HOME, but by adding java.exe to their path.  When done this way, Java works in the sense that you can type "java" in a command prompt and have it understand what that means.  You can compile java from command line and run it with no problem.</p>
<p>The problem we experienced was that JRuby, in windows, specifically looks to see if JAVA_HOME is set.  If it is not set, the JRuby executable bails.  I submitted a <a href="http://jira.codehaus.org/browse/JRUBY-2301">patch</a> to JRuby to fix this behavior, but we could not rely on that solution until it was integrated.</p>
<p>What we are doing now is, in the batch file that we have that calls our application, we look to see if JAVA_HOME is set and, if it is not, step through the PATH looking for java.exe.  We then set JAVA_HOME based on the location.  As a result, by the time the JRuby script runs, JAVA_HOME has been set.</p>
<p>This is actually a handy trick to look for anything in the path in a Windows batch file.</p>
<p>Here's the code:</p>
<p>[code light="true"]<br />
if not &quot;%JAVA_HOME%&quot; == &quot;&quot; goto javaHomeAlreadySet<br />
for %%P in (%PATH%) do if exist %%P\java.exe set JAVA_HOME=%%P..\<br />
:javaHomeAlreadySet<br />
[/code]</p>
