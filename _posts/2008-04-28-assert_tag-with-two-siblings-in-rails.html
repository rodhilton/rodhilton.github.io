---
layout: post
title: Assert_tag With Two Siblings In Rails
categories:
- Programming
tags:
- code
- rails
- ruby
- tests
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  syntaxhighlighter_encoded: '1'
  dsq_thread_id: '606605651'
author:
  login: air0day
  email: blog@air0day.com
  display_name: Rod Hilton
  first_name: Rod
  last_name: Hilton
---
<p>I was recently dealing with a tricky problem while writing some rails tests.</p>
<p>I was writing assert_tags against xml returned by a rails web service in order to test that the xml contained specific values. </p>
<p>Here is a sample of the XML:</p>
<p>[xml]<br />
&lt;elements&gt;<br />
  &lt;element&gt;<br />
    &lt;name&gt;rod&lt;/name&gt;<br />
    &lt;surname&gt;hilton&lt;/surname&gt;<br />
    &lt;value&gt;123&lt;/value&gt;<br />
  &lt;/element&gt;<br />
  &lt;element&gt;<br />
    &lt;name&gt;rod&lt;/name&gt;<br />
    &lt;surname&gt;smith&lt;/surname&gt;<br />
    &lt;value&gt;456&lt;/value&gt;<br />
  &lt;/element&gt;<br />
  &lt;element&gt;<br />
    &lt;name&gt;granny&lt;/name&gt;<br />
    &lt;surname&gt;smith&lt;/surname&gt;<br />
    &lt;value&gt;789&lt;/value&gt;<br />
  &lt;/element&gt;<br />
&lt;/elements&gt;<br />
[/xml]</p>
<p>I want to write three assertions.  If I write this in my test, it will work as expected:</p>
<p>[ruby]<br />
assert_tag :tag=&gt;&quot;value&quot;, :content=&gt;&quot;789&quot;,<br />
           :sibling=&gt;{:tag=&gt;&quot;name&quot;, :content=&gt;&quot;granny&quot;}<br />
[/ruby]</p>
<p>Basically what I'm doing is looking for a value element with the content of 789, and it has to have a sibling of a name element with the content "granny", which assures it will select the last "element" for the value.</p>
<p>The problem is, how do I write a test for the first xml element?  If I look for a sibling with name "rod", it's possible that I'd select the second element.  If look for a sibling with the surname "smith", it's possible that I'd select granny again.  I need to be able to select the tag with TWO siblings.</p>
<p>The documentation is not straightforward about how to do this, but I figured out a method that works.</p>
<p>Essentially, the :sibling hash element takes the same kind of hash that assert_tag takes.  Meaning, you can pass anything into :sibling that you would pass to assert_tag to begin with - including another sibling!</p>
<p>[ruby]<br />
assert_tag :tag=&gt;&quot;value&quot;, :content=&gt;&quot;123&quot;,<br />
           :sibling=&gt;{<br />
             :tag=&gt;&quot;name&quot;, :content=&gt;&quot;rod&quot;,<br />
             :sibling=&gt;{<br />
               :tag=&gt;&quot;surname&quot;, :content=&gt;&quot;hilton&quot;<br />
             }<br />
           }<br />
[/ruby]</p>
<p>Pretty insane, but I wasn't able to figure out a better way.  I was hoping to pass an array of hashes to :sibling, but that didn't work as I had hoped.</p>
<p>If anyone has a better way than this, feel free to leave a comment.  Otherwise, this seems to be a relatively readable way of selecting tags with 2 (or more) siblings in assertions.</p>
